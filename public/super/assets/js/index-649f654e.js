import{d as Se,h as Fe,e as P,_ as Ne,i as Ie,ag as s,aq as Q,o as m,c as K,V as l,P as a,a9 as j,F as O,a8 as U,O as y,T as u,a as V,Q as h,W as H,U as Ke,u as f,n as G}from"./@vue-110897a1.js";import{l as q,h as J,z as qe,x as X,k as De,n as Pe,j as E,i as Oe}from"./index-5e2104fc.js";import{a as S,E as T}from"./element-plus-28d330eb.js";import"./pinia-cd41b998.js";import"./vue-router-17193735.js";import"./vue-i18n-c25bb36f.js";import"./@intlify-d9393dcf.js";import"./vue-cc729cf0.js";import"./js-cookie-edb2da2a.js";import"./@element-plus-ff880098.js";import"./nprogress-28073a82.js";import"./axios-28bc18a3.js";import"./lodash-9a19cd29.js";import"./mitt-f7ef348c.js";import"./@wangeditor-231513dc.js";import"./vue-grid-layout-2853dde1.js";import"./lodash-es-21c98b27.js";import"./@vueuse-0a258a1c.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-816b3f93.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-72afddb3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-432baded.js";const Ue={class:"container"},Ee={class:"mb8"},Te={class:"dialog-footer"},Le={class:"dialog-footer"},il=Se({__name:"index",setup(Be){const{proxy:Y}=Fe(),L=P(null),C=P(null),b=P(null),e=Ne({activeName:"first",loading:!0,bunLoading:!1,ids:[],total:0,title:"",open:!1,roleList:[],showSearch:!0,single:!0,multiple:!0,statusOptions:[],menuOptions:[],menuCheckedKeys:[],deptOptions:[],openDataScope:!1,menuExpand:!1,menuNodeAll:!1,deptExpand:!0,deptNodeAll:!1,queryParams:{pageNum:1,pageSize:10,roleName:void 0,roleKey:void 0,status:void 0},dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],roleForm:{},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),F=()=>{e.menuExpand=!1,e.menuNodeAll=!1,e.deptExpand=!0,e.deptNodeAll=!1,e.roleForm={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},e.roleForm={}},Z=()=>{e.queryParams.pageNum=1,e.queryParams.pageSize=10,e.queryParams.roleName="",e.queryParams.roleKey="",e.queryParams.status="",x()},k=()=>{e.loading=!0,q("/sys/role",e.queryParams).then(r=>{e.roleList=r.rows,e.total=r.total,e.loading=!1})},ee=r=>{e.queryParams.pageSize=r,x()},le=r=>{e.queryParams.pageNum=r,x()},te=()=>{e.roleForm.roleId!=null&&(e.roleForm.deptIds=oe(),J("/sys/role",e.roleForm).then(()=>{S.success("修改成功"),e.openDataScope=!1,k()}))},oe=()=>{const r=f(b);let t=r.getCheckedKeys(),d=r.getHalfCheckedKeys();return t.unshift.apply(t,d),t},x=()=>{e.queryParams.pageNum=1,k()},ae=()=>{q("/sys/menu",{}).then(r=>{e.menuOptions=E(r.rows,"menuId","parentId","children")})},re=r=>{e.ids=r.map(t=>t.roleId),e.single=r.length!=1,e.multiple=!r.length},ne=r=>{let t=r.status==="0"?"启用":"停用";T({closeOnClickModal:!1,closeOnPressEscape:!1,title:"警告",message:'确认要"'+t+'""'+r.roleName+'"角色吗?',showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return qe("/sys/role",{roleId:r.roleId,status:r.status})}).then(()=>{S.success(t+"成功")}).catch(function(){r.status=r.status==="0"?"1":"0"})},de=r=>{F(),pe(),X("/sys/role",r.roleId).then(t=>{e.roleForm=t.data,e.openDataScope=!0,G(()=>{let d=t.data.deptIds;const n=f(b);d.forEach(i=>{n.setChecked(i,!0,!1)})}),e.title="分配数据权限"})},se=()=>{F(),ae(),e.open=!0,e.title="添加角色"},ue=r=>{const t=r.roleId;ie(),X("/sys/role",t).then(d=>{e.roleForm=d.data,e.open=!0,e.title="修改角色",G(()=>{let n=d.data.menuIds;const i=f(C);n.forEach(N=>{i.setChecked(N,!0,!1)})})}),e.bunLoading=!1},B=r=>{const t=r.roleId||e.ids;T({message:'是否确认删除角色编号为"'+t+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return De("/sys/role",t)}).then(()=>{k(),S.success("删除成功")})},me=()=>{const r=e.queryParams;T({message:"是否确认导出所有角色数据项?",title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return Pe("/sys/role",r)}).then(()=>{})},pe=()=>q("/sys/dept",{}).then(r=>(e.deptOptions=E(r.rows,"deptId","parentId","children"),r.data)),ie=()=>q("/sys/menu",{}).then(r=>(e.menuOptions=E(r.rows,"menuId","parentId","children"),r.data)),ce=()=>{const r=f(L);r&&r.validate(t=>{t&&(e.bunLoading=!0,e.roleForm!=null&&e.roleForm.roleId!=null?(e.roleForm.menuIds=W(),J("/sys/role",e.roleForm).then(()=>{S.success("修改成功"),e.bunLoading=!0,e.open=!1,k()})):(e.roleForm.menuIds=W(),Oe("/sys/role",e.roleForm).then(()=>{S.success("新增成功"),e.bunLoading=!0,e.open=!1,k()})))})},fe=()=>{e.open=!1,F()},W=()=>{const r=f(C);if(!r)return;let t=r.getCheckedKeys(),d=r.getHalfCheckedKeys();return t.unshift.apply(t,d),t},ye=()=>{e.openDataScope=!1,F()},_e=r=>{const t=f(b);r!=="2"&&t.setCheckedKeys([])},A=(r,t)=>{if(t=="menu"){let d=e.menuOptions;for(let n=0;n<d.length;n++){const i=f(C);i.store.nodesMap[d[n].menuId].expanded=r}}else if(t=="dept"){let d=e.deptOptions;for(let n=0;n<d.length;n++){const i=f(b);i.store.nodesMap[d[n].deptId].expanded=r}}},z=(r,t)=>{t=="menu"?f(C).setCheckedNodes(r?e.menuOptions:[]):t=="dept"&&f(b).setCheckedNodes(r?e.deptOptions:[])};return Ie(()=>{k(),Y.getDicts("sys_normal_disable").then(r=>{e.statusOptions=r.rows})}),(r,t)=>{const d=s("el-input"),n=s("el-form-item"),i=s("el-option"),N=s("el-select"),_=s("SvgIcon"),p=s("el-button"),D=s("el-form"),g=s("el-table-column"),ge=s("el-switch"),he=s("el-table"),be=s("el-divider"),ke=s("el-pagination"),xe=s("el-card"),c=s("el-col"),Ve=s("el-input-number"),Ce=s("el-radio"),ve=s("el-radio-group"),I=s("el-checkbox"),M=s("el-tree"),R=s("el-row"),$=s("el-dialog"),v=Q("auth"),we=Q("loading");return m(),K("div",Ue,[l(xe,{shadow:"always"},{default:a(()=>[l(D,{model:e.queryParams,ref:"queryForm",inline:!0},{default:a(()=>[l(n,{label:"角色名称",prop:"roleName"},{default:a(()=>[l(d,{placeholder:"角色名称模糊查询",clearable:"",onKeyup:j(x,["enter"]),style:{width:"240px"},modelValue:e.queryParams.roleName,"onUpdate:modelValue":t[0]||(t[0]=o=>e.queryParams.roleName=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"权限字符",prop:"roleKey"},{default:a(()=>[l(d,{placeholder:"权限字符模糊查询",clearable:"",onKeyup:j(x,["enter"]),style:{width:"240px"},modelValue:e.queryParams.roleKey,"onUpdate:modelValue":t[1]||(t[1]=o=>e.queryParams.roleKey=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"状态",prop:"status"},{default:a(()=>[l(N,{modelValue:e.queryParams.status,"onUpdate:modelValue":t[2]||(t[2]=o=>e.queryParams.status=o),placeholder:"角色状态",clearable:"",style:{width:"240px"}},{default:a(()=>[(m(!0),K(O,null,U(e.statusOptions,o=>(m(),y(i,{key:o.dictValue,label:o.dictLabel,value:o.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(p,{type:"primary",onClick:x},{default:a(()=>[l(_,{name:"ele-Search"}),u(" 搜索 ")]),_:1}),l(p,{onClick:Z},{default:a(()=>[l(_,{name:"ele-Refresh"}),u(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"]),V("div",Ee,[h((m(),y(p,{type:"primary",plain:"",onClick:se},{default:a(()=>[l(_,{name:"ele-Plus"}),u("新增 ")]),_:1})),[[v,"system:role:add"]]),h((m(),y(p,{type:"danger",plain:"",disabled:e.multiple,onClick:B},{default:a(()=>[l(_,{name:"ele-Delete"}),u("删除 ")]),_:1},8,["disabled"])),[[v,"system:role:delete"]]),h((m(),y(p,{type:"warning",plain:"",onClick:me},{default:a(()=>[l(_,{name:"ele-Download"}),u("导出 ")]),_:1})),[[v,"system:role:export"]])]),h((m(),y(he,{border:"",data:e.roleList,onSelectionChange:re},{default:a(()=>[l(g,{type:"selection",width:"55",align:"center"}),l(g,{label:"角色编号",prop:"roleId",width:"120"}),l(g,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0}),l(g,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0,width:"150"}),l(g,{label:"显示顺序",prop:"roleSort",width:"100"}),l(g,{label:"状态",align:"center",width:"100"},{default:a(o=>[l(ge,{modelValue:o.row.status,"onUpdate:modelValue":w=>o.row.status=w,"active-value":"0","inactive-value":"1",onClick:w=>ne(o.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),l(g,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),l(g,{label:"操作",align:"center",fixed:"right",width:"280"},{default:a(o=>[h((m(),y(p,{type:"text",onClick:w=>ue(o.row)},{default:a(()=>[l(_,{name:"ele-Edit"}),u("修改 ")]),_:2},1032,["onClick"])),[[v,"system:role:edit"]]),l(p,{type:"text",onClick:w=>de(o.row)},{default:a(()=>[l(_,{name:"ele-CircleCheck"}),u("数据权限 ")]),_:2},1032,["onClick"]),h((m(),y(p,{type:"text",onClick:w=>B(o.row)},{default:a(()=>[l(_,{name:"ele-Delete"}),u("删除 ")]),_:2},1032,["onClick"])),[[v,"system:role:delete"]])]),_:1})]),_:1},8,["data"])),[[we,e.loading]]),h(V("div",null,[l(be),l(ke,{background:"",total:e.total,"current-page":e.queryParams.pageNum,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ee,onCurrentChange:le},null,8,["total","current-page","page-size"])],512),[[H,e.total>0]])]),_:1}),l($,{title:e.title,modelValue:e.open,"onUpdate:modelValue":t[12]||(t[12]=o=>e.open=o),width:"769px",center:""},{footer:a(()=>[V("span",Te,[l(p,{type:"primary",loading:e.bunLoading,onClick:ce},{default:a(()=>[u("确 定")]),_:1},8,["loading"]),l(p,{onClick:fe},{default:a(()=>[u("取 消")]),_:1})])]),default:a(()=>[l(D,{ref_key:"roleFormRef",ref:L,model:e.roleForm,rules:e.rules,"label-width":"120px","label-position":"right"},{default:a(()=>[l(R,null,{default:a(()=>[l(c,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[l(n,{label:"角色名称",prop:"roleName"},{default:a(()=>[l(d,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":t[3]||(t[3]=o=>e.roleForm.roleName=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[l(n,{label:"权限字符",prop:"roleKey"},{default:a(()=>[l(d,{modelValue:e.roleForm.roleKey,"onUpdate:modelValue":t[4]||(t[4]=o=>e.roleForm.roleKey=o),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[l(n,{label:"角色顺序",prop:"roleSort"},{default:a(()=>[l(Ve,{modelValue:e.roleForm.roleSort,"onUpdate:modelValue":t[5]||(t[5]=o=>e.roleForm.roleSort=o),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[l(n,{label:"状态"},{default:a(()=>[l(ve,{modelValue:e.roleForm.status,"onUpdate:modelValue":t[6]||(t[6]=o=>e.roleForm.status=o)},{default:a(()=>[(m(!0),K(O,null,U(e.statusOptions,o=>(m(),y(Ce,{key:o.dictValue,label:o.dictValue},{default:a(()=>[u(Ke(o.dictLabel),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(c,{xs:24},{default:a(()=>[l(n,{label:"权限设置"},{default:a(()=>[V("div",null,[l(I,{modelValue:e.menuExpand,"onUpdate:modelValue":t[7]||(t[7]=o=>e.menuExpand=o),onChange:t[8]||(t[8]=o=>A(o,"menu"))},{default:a(()=>[u("展开/折叠 ")]),_:1},8,["modelValue"]),l(I,{modelValue:e.menuNodeAll,"onUpdate:modelValue":t[9]||(t[9]=o=>e.menuNodeAll=o),onChange:t[10]||(t[10]=o=>z(o,"menu"))},{default:a(()=>[u("全选/全不选 ")]),_:1},8,["modelValue"]),l(M,{class:"tree-border",data:e.menuOptions,"show-checkbox":"",ref_key:"menuRef",ref:C,"node-key":"menuId","empty-text":"加载中，请稍后",props:{label:"menuName",children:"children"},"default-checked-keys":e.menuCheckedKeys},null,8,["data","default-checked-keys"])])]),_:1})]),_:1}),l(c,{xs:24},{default:a(()=>[l(n,{label:"备注"},{default:a(()=>[l(d,{modelValue:e.roleForm.remark,"onUpdate:modelValue":t[11]||(t[11]=o=>e.roleForm.remark=o),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l($,{title:e.title,modelValue:e.openDataScope,"onUpdate:modelValue":t[20]||(t[20]=o=>e.openDataScope=o),width:"769px",center:""},{footer:a(()=>[V("span",Le,[l(p,{type:"primary",onClick:te},{default:a(()=>[u("确 定")]),_:1}),l(p,{onClick:ye},{default:a(()=>[u("取 消")]),_:1})])]),default:a(()=>[l(D,{model:e.roleForm,"label-width":"80px"},{default:a(()=>[l(R,null,{default:a(()=>[l(c,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[l(n,{label:"角色名称"},{default:a(()=>[l(d,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":t[13]||(t[13]=o=>e.roleForm.roleName=o),disabled:!0},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[l(n,{label:"权限字符"},{default:a(()=>[l(d,{modelValue:e.roleForm.roleKey,"onUpdate:modelValue":t[14]||(t[14]=o=>e.roleForm.roleKey=o),disabled:!0},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{xs:24},{default:a(()=>[l(n,{label:"权限范围"},{default:a(()=>[l(N,{modelValue:e.roleForm.dataScope,"onUpdate:modelValue":t[15]||(t[15]=o=>e.roleForm.dataScope=o),onChange:_e},{default:a(()=>[(m(!0),K(O,null,U(e.dataScopeOptions,o=>(m(),y(i,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(c,{xs:24},{default:a(()=>[h(l(n,{label:"数据权限"},{default:a(()=>[V("div",null,[l(I,{modelValue:e.deptExpand,"onUpdate:modelValue":t[16]||(t[16]=o=>e.deptExpand=o),onChange:t[17]||(t[17]=o=>A(o,"dept"))},{default:a(()=>[u("展开/折叠 ")]),_:1},8,["modelValue"]),l(I,{modelValue:e.deptNodeAll,"onUpdate:modelValue":t[18]||(t[18]=o=>e.deptNodeAll=o),onChange:t[19]||(t[19]=o=>z(o,"dept"))},{default:a(()=>[u("全选/全不选 ")]),_:1},8,["modelValue"]),l(M,{class:"tree-border",data:e.deptOptions,"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:b,"node-key":"deptId","empty-text":"加载中，请稍后",props:{label:"deptName",children:"children"}},null,8,["data"])])]),_:1},512),[[H,e.roleForm.dataScope==2]])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{il as default};
